# eBay Active Bids Dashboard (Simple)
# This dashboard shows a clean view of your active eBay bids with status indicators

title: eBay Active Bids
icon: mdi:gavel

views:
  - title: Active Bids
    path: active-bids
    icon: mdi:gavel
    badges: []
    cards:
      # Summary Card
      - type: entities
        title: Bid Summary
        entities:
          - entity: sensor.ebay_my_personal_ebay_active_bids
            name: Total Active Bids
            icon: mdi:gavel
        
      # Refresh Button
      - type: button
        name: Refresh Bids
        icon: mdi:refresh
        tap_action:
          action: call-service
          service: ebay.refresh_bids
          service_data:
            account: "My Personal eBay"
        
      # Active Bids List
      - type: markdown
        title: Your Active Bids
        content: >-
          {% set bids = state_attr('sensor.ebay_my_personal_ebay_active_bids', 'items') %}
          {% if bids %}
            {% for bid in bids %}
              ---
              ### {{ bid.title }}
              
              ![Item]({{ bid.image_url }}){: width="200px"}
              
              **Seller:** [{{ bid.seller_username }}]({{ bid.seller_url }}) ({{ bid.seller_feedback_score }} feedback, {{ bid.seller_positive_percent }}% positive)
              
              **Current Price:** {{ bid.current_price.value }} {{ bid.current_price.currency }}
              
              **Status:** {% if bid.is_high_bidder %}ğŸŸ¢ **Winning**{% else %}ğŸ”´ **Outbid**{% endif %}
              {% if bid.reserve_met != None %}| Reserve: {% if bid.reserve_met %}âœ… Met{% else %}âŒ Not Met{% endif %}{% endif %}
              
              **Time Remaining:** {{ bid.time_remaining }}
              
              **Bids:** {{ bid.bid_count if bid.bid_count else 'N/A' }}
              
              [View on eBay]({{ bid.item_url }})
              
            {% endfor %}
          {% else %}
            No active bids
          {% endif %}

      # Ending Soon Alert
      - type: conditional
        conditions:
          - condition: numeric_state
            entity: sensor.ebay_my_personal_ebay_active_bids
            above: 0
        card:
          type: markdown
          title: âš ï¸ Ending Soon
          content: >-
            {% set bids = state_attr('sensor.ebay_my_personal_ebay_active_bids', 'items') %}
            {% set ending_soon = [] %}
            {% for bid in bids %}
              {% set time_parts = bid.time_remaining.split() %}
              {% if 'hour' in bid.time_remaining and time_parts[0]|int < 2 %}
                {% set ending_soon = ending_soon + [bid] %}
              {% elif 'minute' in bid.time_remaining %}
                {% set ending_soon = ending_soon + [bid] %}
              {% endif %}
            {% endfor %}
            
            {% if ending_soon %}
              {% for bid in ending_soon %}
                - **{{ bid.title }}** - {{ bid.time_remaining }} - [View]({{ bid.item_url }})
              {% endfor %}
            {% else %}
              No auctions ending in the next 2 hours
            {% endif %}
