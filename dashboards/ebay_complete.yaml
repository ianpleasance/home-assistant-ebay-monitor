# eBay Complete Dashboard
# Comprehensive view of all eBay activity: searches, bids, watchlist, and purchases

title: eBay Complete
icon: mdi:shopping

views:
  - title: Overview
    path: overview
    icon: mdi:view-dashboard
    badges: []
    cards:
      # Summary Statistics
      - type: horizontal-stack
        cards:
          - type: entity
            entity: sensor.ebay_my_personal_ebay_active_bids
            name: Active Bids
            icon: mdi:gavel
          - type: entity
            entity: sensor.ebay_my_personal_ebay_watchlist
            name: Watching
            icon: mdi:eye
          - type: entity
            entity: sensor.ebay_my_personal_ebay_purchases
            name: Purchases
            icon: mdi:shopping
      
      # Quick Actions
      - type: horizontal-stack
        cards:
          - type: button
            name: Refresh All
            icon: mdi:refresh
            tap_action:
              action: call-service
              service: ebay.refresh_account
              service_data:
                account: "My Personal eBay"
          - type: button
            name: eBay.co.uk
            icon: mdi:web
            tap_action:
              action: url
              url_path: "https://www.ebay.co.uk"
      
      # Recent Activity
      - type: markdown
        title: ğŸ”” Recent Activity
        content: >-
          {% set bids = state_attr('sensor.ebay_my_personal_ebay_active_bids', 'items') %}
          {% set purchases = state_attr('sensor.ebay_my_personal_ebay_purchases', 'items') %}
          
          **Active Bids:** {{ bids|length if bids else 0 }}
          
          {% if bids %}
            {% set winning = bids | selectattr('is_high_bidder', 'equalto', true) | list %}
            - ğŸŸ¢ Winning: {{ winning|length }}
            - ğŸ”´ Outbid: {{ (bids|length) - (winning|length) }}
          {% endif %}
          
          **Recent Purchases:** {{ purchases|length if purchases else 0 }}
          
          {% if purchases %}
            {% set shipped = purchases | selectattr('shipping_status', 'equalto', 'shipped') | list %}
            {% set delivered = purchases | selectattr('shipping_status', 'equalto', 'delivered') | list %}
            - ğŸ“¦ Shipped: {{ shipped|length }}
            - âœ… Delivered: {{ delivered|length }}
          {% endif %}

  - title: Searches
    path: searches
    icon: mdi:magnify
    badges: []
    cards:
      # Refresh Button
      - type: button
        name: Refresh All Searches
        icon: mdi:refresh
        tap_action:
          action: call-service
          service: ebay.refresh_account
          service_data:
            account: "My Personal eBay"
      
      # List all search sensors dynamically
      - type: markdown
        title: Saved Searches
        content: >-
          {% for state in states.sensor %}
            {% if 'ebay' in state.entity_id and 'search' in state.entity_id %}
              ---
              ### {{ state.attributes.search_query }}
              
              **Results:** {{ state.state }}
              
              **Last Updated:** {{ state.attributes.last_updated | as_timestamp | timestamp_custom('%H:%M %d/%m/%Y') if state.attributes.last_updated else 'Never' }}
              
              {% if state.attributes.items %}
                {% for item in state.attributes.items[:5] %}
                  - **{{ item.title }}** - {{ item.current_price.value }} {{ item.current_price.currency }} - [View]({{ item.item_url }})
                {% endfor %}
                {% if state.attributes.items|length > 5 %}
                  ... and {{ state.attributes.items|length - 5 }} more
                {% endif %}
              {% else %}
                No results found
              {% endif %}
              
              [ğŸ”„ Refresh]({{ '/developer-tools/service?service=ebay.refresh_search&data={"search_id":"' ~ state.attributes.search_id ~ '"}' }})
            {% endif %}
          {% endfor %}

  - title: Active Bids
    path: bids
    icon: mdi:gavel
    badges: []
    cards:
      - type: entity
        entity: sensor.ebay_my_personal_ebay_active_bids
        name: Total Active Bids
      
      - type: button
        name: Refresh Bids
        icon: mdi:refresh
        tap_action:
          action: call-service
          service: ebay.refresh_bids
          service_data:
            account: "My Personal eBay"
      
      # Bids List
      - type: markdown
        title: Your Active Bids
        content: >-
          {% set bids = state_attr('sensor.ebay_my_personal_ebay_active_bids', 'items') %}
          {% if bids %}
            {% for bid in bids %}
              ---
              ### {{ bid.title }}
              
              ![Item]({{ bid.image_url }}){: width="150px"}
              
              **Seller:** [{{ bid.seller_username }}]({{ bid.seller_url }}) 
              ({{ bid.seller_feedback_score }} | {{ bid.seller_positive_percent }}% positive)
              {% if bid.seller_location %} | {{ bid.seller_location }}{% endif %}
              
              **Current Price:** {{ bid.current_price.value }} {{ bid.current_price.currency }}
              
              **Status:** 
              {% if bid.is_high_bidder %}ğŸŸ¢ **Winning**{% else %}ğŸ”´ **Outbid**{% endif %}
              {% if bid.reserve_met != None %} | Reserve: {% if bid.reserve_met %}âœ…{% else %}âŒ{% endif %}{% endif %}
              
              **Time Remaining:** â° {{ bid.time_remaining }}
              
              **Bids:** {{ bid.bid_count if bid.bid_count else 'N/A' }}
              
              [View on eBay]({{ bid.item_url }}) | ID: {{ bid.item_id }}
              
            {% endfor %}
          {% else %}
            No active bids
          {% endif %}

  - title: Watchlist
    path: watchlist
    icon: mdi:eye
    badges: []
    cards:
      - type: entity
        entity: sensor.ebay_my_personal_ebay_watchlist
        name: Total Watching
      
      - type: button
        name: Refresh Watchlist
        icon: mdi:refresh
        tap_action:
          action: call-service
          service: ebay.refresh_watchlist
          service_data:
            account: "My Personal eBay"
      
      # Watchlist
      - type: markdown
        title: Your Watchlist
        content: >-
          {% set items = state_attr('sensor.ebay_my_personal_ebay_watchlist', 'items') %}
          {% if items %}
            {% for item in items %}
              ---
              ### {{ item.title }}
              
              ![Item]({{ item.image_url }}){: width="150px"}
              
              **Seller:** [{{ item.seller_username }}]({{ item.seller_url }})
              ({{ item.seller_feedback_score }} | {{ item.seller_positive_percent }}% positive)
              
              **Current Price:** {{ item.current_price.value }} {{ item.current_price.currency }}
              
              **Type:** {{ item.listing_type }}
              
              {% if item.time_remaining %}
              **Time Remaining:** â° {{ item.time_remaining }}
              {% endif %}
              
              {% if item.watchers %}
              **Watchers:** ğŸ‘ï¸ {{ item.watchers }}
              {% endif %}
              
              [View on eBay]({{ item.item_url }})
              
            {% endfor %}
          {% else %}
            No items in watchlist
          {% endif %}

  - title: Purchases
    path: purchases
    icon: mdi:shopping
    badges: []
    cards:
      - type: entity
        entity: sensor.ebay_my_personal_ebay_purchases
        name: Total Purchases
      
      - type: button
        name: Refresh Purchases
        icon: mdi:refresh
        tap_action:
          action: call-service
          service: ebay.refresh_purchases
          service_data:
            account: "My Personal eBay"
      
      # Purchases List
      - type: markdown
        title: Your Recent Purchases
        content: >-
          {% set purchases = state_attr('sensor.ebay_my_personal_ebay_purchases', 'items') %}
          {% if purchases %}
            {% for item in purchases %}
              ---
              ### {{ item.title }}
              
              ![Item]({{ item.image_url }}){: width="150px"}
              
              **Seller:** [{{ item.seller_username }}]({{ item.seller_url }})
              
              **Price Paid:** {{ item.current_price.value }} {{ item.current_price.currency }}
              
              **Shipping Status:** 
              {% if item.shipping_status == 'delivered' %}
                âœ… Delivered
              {% elif item.shipping_status == 'shipped' %}
                ğŸ“¦ Shipped
                {% if item.tracking_number %}
                  (Tracking: {{ item.tracking_number }})
                {% endif %}
              {% else %}
                â³ Pending
              {% endif %}
              
              [View on eBay]({{ item.item_url }})
              
            {% endfor %}
          {% else %}
            No recent purchases
          {% endif %}
